# setup-haskell
[![build-badge][]][build]
[![selftest.ubuntu-18.04-badge][]][selftest.ubuntu-18.04]
[![selftest.ubuntu-20.04-badge][]][selftest.ubuntu-20.04]
[![selftest.ubuntu-22.04-badge][]][selftest.ubuntu-22.04]
[![selftest.macos-10.15-badge][]][selftest.macos-10.15]
[![selftest.macos-11-badge][]][selftest.macos-11]
[![selftest.macos-12-badge][]][selftest.macos-12]
[![selftest.windows-2019-badge][]][selftest.windows-2019]
[![selftest.windows-2022-badge][]][selftest.windows-2022]

This action sets up a Haskell environment for use in GitHub Actions by:

- installing a request version of [`ghc`][] and adding it to the `PATH`
- adding `$HOME/.cabal/bin/` to the `PATH`

The GitHub runners come with [pre-installed versions of `ghc`, `cabal` and
`stack`][preinstalled-software].

The pre-installed version of `ghc` will be used when possible.  For all other
versions, this action utilizes [`ppa:hvr/ghc`][] and [`ghcup`][].

[preinstalled-software]: https://docs.github.com/en/actions/using-github-hosted-runners/about-github-hosted-runners#preinstalled-software

[`ghc`]: https://downloads.haskell.org/ghc/latest/docs/users_guide/
[`ghcup`]: https://www.haskell.org/ghcup/
[`ppa:hvr/ghc`]: https://launchpad.net/~hvr/+archive/ubuntu/ghc

[build]: https://github.com/hspec/setup-haskell/actions/workflows/build.yml
[build-badge]: https://github.com/hspec/setup-haskell/actions/workflows/build.yml/badge.svg
[selftest.macos-10.15]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.macos-10.15.yml
[selftest.macos-11]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.macos-11.yml
[selftest.macos-12]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.macos-12.yml
[selftest.ubuntu-18.04]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.ubuntu-18.04.yml
[selftest.ubuntu-20.04]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.ubuntu-20.04.yml
[selftest.ubuntu-22.04]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.ubuntu-22.04.yml
[selftest.windows-2019]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.windows-2019.yml
[selftest.windows-2022]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.windows-2022.yml
[selftest.macos-10.15-badge]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.macos-10.15.yml/badge.svg
[selftest.macos-11-badge]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.macos-11.yml/badge.svg
[selftest.macos-12-badge]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.macos-12.yml/badge.svg
[selftest.ubuntu-18.04-badge]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.ubuntu-18.04.yml/badge.svg
[selftest.ubuntu-20.04-badge]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.ubuntu-20.04.yml/badge.svg
[selftest.ubuntu-22.04-badge]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.ubuntu-22.04.yml/badge.svg
[selftest.windows-2019-badge]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.windows-2019.yml/badge.svg
[selftest.windows-2022-badge]: https://github.com/hspec/setup-haskell/actions/workflows/selftest.windows-2022.yml/badge.svg

## Usage

**Plain:**

If you want to test a Haskell project with a recent version of `stack` of
`cabal` then you don't need this action at all.

With `stack`:

```
name: build
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: stack test --pedantic
```

With `cabal`:

```yaml
name: build
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - run: cabal update
      - run: cabal configure --enable-tests # NOTE: --enable-tests is necessary due to https://github.com/haskell/cabal/issues/5079
      - run: cabal build all
      - run: cabal test all --test-show-details=direct
```

**Basic:**

```yaml
name: build
on: [push]
jobs:
  build:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v3
      - uses: hspec/setup-haskell@v1
        with:
          ghc-version: "8.10"

      - run: cabal update
      - run: cabal configure --enable-tests # NOTE: --enable-tests is necessary due to https://github.com/haskell/cabal/issues/5079
      - run: cabal build all
      - run: cabal test all --test-show-details=direct
```

## Supported versions
<!-- BEGIN generated by generate/readme.ts -->
|                        | `ubuntu-18.04` | `ubuntu-20.04` | `ubuntu-22.04` | `macos-10.15` | `macos-11` | `macos-12` | `windows-2019` | `windows-2022` |
| :--------------------- | :------------: | :------------: | :------------: | :-----------: | :--------: | :--------: | :------------: | :------------: |
| `latest` `9.4` `9.4.4` |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.4.3`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.4.2`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.4.1`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.2` `9.2.5`          |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.2.4`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.2.3`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.2.2`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.2.1`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.0` `9.0.2`          |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `9.0.1`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.10` `8.10.7`        |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.10.6`               |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.10.5`               |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.10.4`               |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.10.3`               |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.10.2`               |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.10.1`               |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.8` `8.8.4`          |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.8.3`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       ❌       |
| `8.8.2`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.8.1`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.6` `8.6.5`          |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.6.4`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.6.3`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.6.2`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.6.1`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.4` `8.4.4`          |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.4.3`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.4.2`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.4.1`                |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.2` `8.2.2`          |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `8.0` `8.0.2`          |       🟢       |       🟢       |       🟢       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `7.10` `7.10.3`        |       🟢       |       🟢       |       ❌       |       🟢      |     🟢     |     🟢     |       🟢       |       🟢       |
| `7.8` `7.8.4`          |       🟢       |       ❌       |       ❌       |       ❌      |     ❌     |     ❌     |       ❌       |       ❌       |
| `7.6` `7.6.3`          |       🟢       |       ❌       |       ❌       |       ❌      |     ❌     |     ❌     |       ❌       |       ❌       |
| `7.4` `7.4.2`          |       🟢       |       🟢       |       ❌       |       ❌      |     ❌     |     ❌     |       ❌       |       ❌       |
| `7.4.1`                |       🟢       |       ❌       |       ❌       |       ❌      |     ❌     |     ❌     |       ❌       |       ❌       |
| `7.2` `7.2.2`          |       🟢       |       🟢       |       ❌       |       ❌      |     ❌     |     ❌     |       ❌       |       ❌       |
| `7.0` `7.0.4`          |       🟢       |       🟢       |       ❌       |       ❌      |     ❌     |     ❌     |       ❌       |       ❌       |
| `7.0.1`                |       🟢       |       🟢       |       ❌       |       ❌      |     ❌     |     ❌     |       ❌       |       ❌       |
<!-- generated by generate/readme.ts END -->

## Design principles

- ⏱️ fast: do the minimum amount of work that is required for a correct
  solution
- 🦾 robust: Don't assume, verify.
    - All critical components of this action are unit tested.
    - selftest
    - verify after install
- 🎯 focused: Do one thing, but do it right (Unix-style).  This action only
  installs `ghc`.  It does not try to install `cabal` or `stack`.  The GitHub
  runners provide recent versions of `stack` and `cabal` that can be used.
- 🔥 recent: `latest` will always give you the latest version of `ghc`.  This
  action does not require housekeeping to support new versions of GHC.  The
  version matrix in the `README` needs to be updated periodically, but again,
  this is detected by CI and mostly automated.

## Alternatives
> ...failing tests are bad, test that pass even though they should fail are
> worse...

- [`actions/setup-haskell`][] is unmaintained.
- [`haskell/actions`][] is a maintained fork of [`actions/setup-haskell`][].
  However, it's lacking in the "robustness" department.  At some point it would
  go so far as to [silently use the wrong version of
  `ghc`](https://github.com/haskell/actions/issues/80) to run your tests.  It's
  also less focused and does not follow [standard conventions for GitHub
  actions](
  https://github.com/haskell/actions/issues/18#issuecomment-762914338).

[`haskell/actions`]: https://github.com/haskell/actions
[`actions/setup-haskell`]: https://github.com/actions/setup-haskell
